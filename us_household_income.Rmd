---
title: "US_Household_Income"
author: "Naeem Chowdhury, Rosa Gradilla"
date: "December 2, 2019"
output: html_document
editor_options: 
  chunk_output_type: console
---


##Setup
### options
Set up global options

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE)
knitr::opts_chunk$set(tidy=TRUE)
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=70))
knitr::opts_chunk$set(fig.height=4, fig.width=6)
```


### libraries
Load in needed libraries 
```{r libraries}
# Run these if you don't have these libraries yet
# install.packages("tidyverse") 
# install.packages("data.table")
# install.packages("plotly") #For pretty plots
library(tidyverse) # For data processing and visualization
library(data.table) # For creating tables
library(plotly)
library(ggplot2)
library(reshape2)
spot_color = "#9ecae1" 
text_color = "#525252"
```

### File management
Create variables for directories
```{r file_management}
home.dir <- getwd()
data.dir <- './rawData'
viz.dir <- './dataViz'
output.dir <- './output'
```

## Preprocessing
### import
```{r}
df_income <- read_csv(file.path(home.dir, data.dir, 'kaggle_income.csv'), na = c(''))
```


## Exploration (Playground)

### Quantitative Variables
Mean, Median, St. Dev, Sum of Weights, AWater, ALand

### Qualitative Variables
everything else

### Histograms
```{r}
# These histograms satisfy the distribution requirement of the project.
ggplot(data = df_income)+
  geom_histogram(mapping = aes(x = data$Mean, fill = data$Type), bins = 40) +
  labs(x = "Household Income (Mean)") +
  scale_fill_discrete(name = "Household Type")
```

```{r}
# Distribution
ggplot(data = data)+
  geom_histogram(mapping = aes(x = data$Median, fill = data$Type), bins = 40) +
  labs(x = "Household Income (Median)") +
  scale_fill_discrete(name = "Household Type")
```

```{r}
hist <- plot_ly(x = df_income$Type, type = "histogram")
hist
```

### What's going on with all the rich people?
```{r}
# There are 4k+ data points which have precisely 300000 dollars as their median income value. This is a data anomaly that messes with our summary statistics, so we decided it would be best to toss them out.
rich_people <- df_income %>% filter(Median == 300000)
```


## Analysis

### Correlation Matrix
```{r}
quant_vars <- df_income %>% 
  select(Mean, Median, Stdev, AWater, ALand)

cor_quant <- cor(quant_vars)

melted_quant <- melt(cor_quant)

ggplot(data = melted_quant, aes(x=Var1, y=Var2, fill=value)) + 
  geom_tile()
```

### Scatter Plots and Linear Regressions
```{r}
# An initial scatter plot to see the shape of the relationship
ggplot(quant_vars, aes(x=Median, y=AWater)) + geom_point()
ggplot(quant_vars, aes(x=Median, y=ALand)) + geom_point()

# It seems that the correlations we produced in the previous section are a result of outlier values that skew the data. Lets try throwing out the outliers.
```

### Data Reshaping to get rid of Problem Points
```{r}
df_income <- df_income %>% filter(Median != 300000 & Median != 0)

quant_vars <- df_income %>% 
  select(Mean, Median, Stdev, AWater, ALand)

```



### One-Sample Statistical Inference for Income
*above 50
*under 50

-Construct a confidence interval for income's population mean value. (Make sure to check assumptions and interpret the CI)
-Conduct a hypothesis test against a certain value. Interpret its results

```{r}

```

### Statistical Inference for Type

-Construct a CI, hypothesis test against a prespecified constant.

```{r}

```

### Two-sample statistical inference

Is there a significant difference between the household incomes in cities and towns?

Check assumptions, interpret the results

```{r}

```

For the confidence interval and hypothesis test conducted, we will run simulations: 
we will take a random subsample of fixed size from our full data set, we will then proceed to calculate the confidence intervals and hypothesis tests against the true sample mean, record the coverage and type I errors obtained.

```{r}

```

